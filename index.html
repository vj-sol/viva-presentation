<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="author" content="Vijay Solanki">

    <title>R for Arts</title>

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/white.css">

    <!-- Theme used for syntax highlighting of code -->
    <!--     <link rel="stylesheet" href="lib/css/atelier-heath-dark.css"> -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!--Add support for earlier versions of Internet Explorer -->
    <!--[if lt IE 9]>
<script src="lib/js/html5shiv.js"></script>
<![endif]-->

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

  </head>
  <body>
    <div class="reveal">
      <div class="slides">


        <!--    NEW TOP LEVEL SLIDE      -->
        <section>
          <section>
            <h1>
              <img src='resources/R-logo.png' alt='R logo' style='background:none; border:none; box-shadow:none;'> for Arts
            </h1>
            <h4>
              Session 3
            </h4>
            <h4>
              March 24<sup><small>th</small></sup> 2017
            </h4>
            <aside class='notes'>

            </aside>
          </section>
          <section>
            <h3>
              Feedback
            </h3>
          </section>

        </section>




        <!--    NEW TOP LEVEL SLIDE      -->
        <section align='left'>

          <section>
            <h2 align='center'>
              Recap Session 2
            </h2>
            <aside class='notes'>

            </aside>
          </section>

          <section>
            <h3>
              Core concepts
            </h3>
            <div style='font-size:50%'>
              <ol>
                <li class='fragment' style='font-size:100%'><b>Packages</b>
                  <ol>
                    <li type='a'>Installing packages</li>
                    <li type='a'>Using packages</li>
                    <li type='a'>Dealing with masked functions</li>
                  </ol>
                </li>
                <br/>
                <li class='fragment' style='font-size:100%'><b>Importing Data</b>
                  <ol>
                    <li type='a'>Understand the csv file format</li>
                    <li type='a'>Understand how to import csv files into R</li>
                  </ol>
                </li>
                <br/>
                <li class='fragment' style='font-size:100%'><b>Navigating Data</b>
                  <ol>
                    <li type='a'>Understand how to select elements of 1D and 2D data</li>
                    <li type='a'>Understand how to select rows or columns of 2D data</li>
                    <li type='a'>Understand how to use $ to select columns from <pre style='display:inline'><code style='display:inline' class='r'>data.frames</code></pre></li>
                  </ol>
                </li>
                <br/>
                <li class='fragment' style='font-size:100%'><b>Tidying Data</b>
                  <ol>
                    <li type='a'>Understand the concept of tidy data</li>
                    <li type='a'>Understand how to transform into tidy format using tidyr</li>
                  </ol>
                </li>
                <br/>
                <li class='fragment' style='font-size:100%'><b>Checking and Selecting Data</b>
                  <ol>
                    <li type='a'>Checking for complete observations</li>
                    <li type='a'>Dealing with missing values</li>
                    <li type='a'>Selecting data based on data content</li>
                    <li type='a'>Dealing with textual data</li>
                  </ol>
                </li>
                <br/>
                <li class='fragment' style='font-size:100%'><b>Descriptives</b>
                  <ol>
                    <li type='a'>Provided functions for producing basic descriptive statistics</li>
                  </ol>
                </li>
              </ol>
            </div>
            <aside class='notes'>

            </aside>
          </section>

          <section>
            <div style='font-size:60%'>
              <h3>
                Coding Practice (<span style='color:red'>CP</span>)
              </h3>
              <h4>
                <span style='color:red'>CP1:</span> # everything, because #YOLO
              </h4>
              <!--             <p class='fragment'>
Possibly, one of the more important pieces of advice.
</p> -->
              <p class='fragment'>
                In R, the <span style='font-size:150%'>#</span> symbol will 'comment out' everything that follows it on that line.
              </p>
              <p class='fragment'>
                This allows you to make comments about your work and is SUPER IMPORTANT!
              </p>
              <h4>
                <span style='color:red'>CP2:</span> Leave yourself space!
              </h4>
              <p class='fragment'>
                Code is hard to read at the best of times.
              </p>
              <p class='fragment'>
                Make life easy for yourself and put spaces between code elements.
              </p>
              <!--             <div class='fragment'>
Bad:
<pre><code class='r'>1+2+3+4+5+6+7+8+9+10</code></pre>
</div>
<div class='fragment'>
Good:
<pre><code class='r'>1 + 2 + 3 + 4 + 5 + 6 + 7 + 8 + 9 + 10</code></pre>
</div> -->
              <h4>
                <span style='color:red'>CP3:</span> Sensible names
              </h4>
              <!--             <p class='fragment'>
Providing your R <span style='display:inline;color:blue;margin-top:0'>objects</span> with sensible names will save you a lot of pain in the future.
</p> -->
              <div class='fragment'>
                <p>
                  <span style='color:blue'>Object</span> names require the following:
                <ul>
                  <li>They MUST begin with a letter</li>
                  <li>They MUST NOT contain spaces</li>
                  <li>They ARE case sensitive</li>
                  <li>They can ONLY contain letters, numbers, <span style='color:red'>_</span> and <span style='color:red'>.</span> </li>
                </ul>
                </p>
            </div>
            <div class='fragment'>
              <p>
                Be consistent in your naming convention, some example conventions are:
              <ul>
                <li>this_is_snake_case</li>
                <li>ThisIsCamelCase</li>
                <li>this.uses.full.stops</li>
              </ul>
              </p>
            </div>
          </div>
        <aside class='notes'>

        </aside>
        </section>

      <section>
        <h2 align='center'>
          Questions?
        </h2>
        <aside class='notes'>

        </aside>
      </section>

      </section>

    <!--    NEW TOP LEVEL SLIDE      -->
    <section align='left'>

      <section>
        <h2 align='center'>
          Session 3
        </h2>
        <aside class='notes'>
        </aside>
      </section>

      <section>
        <h3>
          A (slightly) different format
        </h3>
        <p>
          The last 2 sessions have been heavily front-loaded with info.
        </p>
        <p>
          This session will have a (slightly) different format.
        </p>
        <ol>
          <li class='fragment'>Explain ggplot2</li>
          <li class='fragment'>Demonstrate report generation tools</li>
          <li class='fragment'>Work through a full analysis script</li>
          <li class='fragment'>Straight to projects (no exercises)</li>
        </ol>
      </section>
    </section>




    <!--    NEW TOP LEVEL SLIDE      -->
    <section align='left'>

      <section>
        <h2 align='center' style='text-transform:lowercase'>
          ggplot2
        </h2>
        <aside class='notes'>

        </aside>
      </section>

      <section>
        <h3 style='text-transform:lowercase'>
          ggplot2
        </h3>
        <p>
          A widely used package for producing publication quality graphs.
        </p>
        <ul class='fragment' data-fragment-index='1'>
          <li>Very flexible</li>
          <li>Support for vector graphics</li>
          <li>Reasonably easy to use</li>
        </ul>
        <p class='fragment' data-fragment-index='2'>
          Documentation for ggplot2 can be found at:
        <p  class='fragment' style='font-size:100%'  data-fragment-index='2'>
          <a href='http://docs.ggplot2.org/current'>http://docs.ggplot2.org</a>
        </p>
        </p>
      <aside class='notes'>

      </aside>
    </section>

    <section>
      <h3>
        Installing <span style='text-transform:lowercase'>ggplot2</span>
      </h3>

      Recall from session 2 that we use the <pre style='display:inline'><code style='display:inline' class='r'>install.packages()</code></pre> command to install packages.

      <div class='fragment'>
        <p>
          For ggplot2 the command would be: <pre><code class='r'>install.packages('ggplot2')</code></pre>
        </p>
      </div>
    <aside class='notes'>

    </aside>
    </section>

  <section>
    <h3>
      Some examples: bar plot
    </h3>
    <div align='center' class='stretch'>
      <img src='./resources/gg-bar.svg' alt='Density plot - ggplot2' width='50%' style='border:0'/>
      <pre><code class='r'>ggplot( mtcars , aes( gear )) +
    geom_bar() +
    labs( x = 'Gears' , y = 'Count') +
    theme_classic()</code></pre>
    </div>
  </section>

  <section>
    <h3>
      Some examples: scatter plot
    </h3>
    <div align='center' class='stretch'>
      <img src='./resources/gg-point.svg' alt='Density plot - ggplot2' width='50%' style='border:0'/>
      <pre><code class='r'>ggplot( mtcars , aes( mpg , hp )) +
    geom_point()+
    labs( x = 'Miles per Gallon' , y = 'Horse Power') +
    geom_smooth( method = 'lm' , colour='black') +
    theme_bw()
</code></pre>
    </div>
  </section>

  <section>
    <h3>
      Some examples: box plot
    </h3>
    <div align='center' class='stretch'>
      <img src='./resources/gg-box.svg' alt='Density plot - ggplot2' width='50%' style='border:0'/>
      <pre><code class='r'>ggplot( mtcars , aes( as.factor( gear ) , mpg )) +
    geom_boxplot() +
    labs( x = 'Gears' , y = 'Miles per Gallon') +
    theme_minimal()
</code></pre>
    </div>
  </section>

  <section>
    <h3>
      Some examples: density plot
    </h3>
    <div align='center' class='stretch'>
      <img src='./resources/gg-density.svg' alt='Density plot - ggplot2' width='50%' style='border:0'/>
      <pre><code class='r'>ggplot( mtcars , aes( mpg , fill = as.factor( gear ), colour = as.factor( gear ))) +
  geom_density( alpha = 0.1 ) +
  labs( x = 'Miles per Gallon' , y = 'Density') +
  guides( fill = guide_legend( title = 'Gears'), colour = guide_legend( title = 'Gears'))</code></pre>
    </div>
  </section>

  <section>
    <iframe class='stretch' src='./resources/int_plot/index.html' style='width:100%'>    </iframe>
    <div style=font-size:50%>
      <pre><code class='r'>library(plotly)
scatter <- ggplot(mtcars,aes(mpg,hp)) +
  geom_point() +
  labs( x = 'Miles per Gallon' , y = 'Horse Power') +
  geom_smooth(method='lm',colour='black') +
  facet_grid(~as.factor(gear),scales='free') +
  theme_bw()

ggplotly(scatter)  </code></pre>
    </div>
      </section>

    <section>
      <h3>
        <span style=color:red>CP4:</span> Indent your tweaks
      </h3>
      <p>
        Indent the additional tweaks you make to your graph to improve clarity, e.g.
      </p>
      <ul>
        <li>bad:<pre><code style=display:inline class='r'>ggplot(mtcars,aes(mpg,hp))+geom_point()+labs(x='MPG',y='HP')</code></pre></li>
        <li>good:<pre><code class='r'>ggplot( mtcars , aes( mpg , hp )) +
        geom_point() +
        labs( x = 'MPG' , y = 'HP' )</code></pre></li>
      </ul>
    </section>

  </section>




  <!--    NEW TOP LEVEL SLIDE      -->
  <section align='left'>
    <section align='center'>
      <h2>
        Understanding the grammar
      </h2>
    </section>

    <section>
      <h3>
        2 core concepts
      </h3>
      <p>
        The two main ggplot elements that you need to understand are:
      </p>
      <ul>
        <li>geometric objects (geom)</li>
        <li>aesthetics (aes)</li>
      </ul>
      <br/>
      <div class='fragment' align='center'>
        <img src='./resources/gg-basic-bar.svg' width='35%' style='border:0'/>
        <pre><code class='r'>ggplot( data = mtcars , aes( x = gear )) +
      geom_bar()</code></pre>
      </div>
      <aside class='notes'>

      </aside>
    </section>

    <section>
      <h3>
        Geometric objects: <pre style='display:inline; text-transform:lowercase'><code style='display:inline;text-transform:lowercase' class='r'>geom()</code></pre>
      </h3>
      <p>
        Controls the visual elements of the graph.
      </p>
      <div class='fragment'>
      <p>
        This includes things such as whether we want a:
      <ul>
        <li>bar chart</li>
        <li>box plot</li>
        <li>scatter plot</li>
        <li>density plot</li>
      </ul>
      </p>
      </div>
    <p class='fragment'>
      Multiple geometric objects can be placed on the same graph.
    </p>

    <aside class='notes'>

    </aside>
  </section>

  <section>
    <h3>
      Aesthetics: <pre style='display:inline; text-transform:lowercase'><code style='display:inline;text-transform:lowercase' class='r'>aes()</code></pre>
    </h3>
    <p>
      Controls the appearance of graph elements.
    </p>
    <div class='fragment'>
    <p>
      This includes things such as an element's:
    <ul>
      <li>size</li>
      <li>shape</li>
      <li>colour</li>
      <li>location</li>
    </ul>
    </p>
    </div>
  <p class='fragment'>
    Aesthetics can be set globally or locally.
  </p>
  </section>


<section>
  <h3>
    Layers
  </h3>
  <p>
    When designing and dealing with ggplots, it can be helpful to think of them as a series of layers.
  </p>
  <div align='center'>
    <img src='./resources/ggplot.png' alt='ggplot layers - Andy Field' width='50%' style='border:0'/>
  </div>
  <div align='right'>
    <small>Image from 'Discovering statistics using R' by Field, Miles and Field. pp. 122</small>
  </div>
  <aside class='notes'>

  </aside>
</section>
<section align='center' style='font-size:80%'>
  <h2>
    Anatomy of a <span style=text-transform:lowercase>ggplot</span> call
  </h2>
</section>

<section>
  <h3>
    Work that <pre style=text-transform:lowercase;display:inline><code class='r' style=text-transform:lowercase;display:inline>aes()</code></pre>
  </h3>

  Many common ggplot tasks can be accomplished by adjusting the terms within the <pre style=display:inline><code style=display:inline class='r'>aes()</code></pre>
  <div class='fragment'>
  <p>
    It is in this function that we define what is on our axes
  </p>
  <pre><code class='r'>ggplot(data = mtcars, aes(x = mpg, y = hp))</code></pre>
  </div>
  <div class='fragment'>
   <p>
    And how we want to represent our data elements
  </p>
  <pre><code class='r'>ggplot(data = mtcars, aes(x = mpg, y = hp, colour = as.factor(vs), shape = as.factor(gear)))</code></pre>
  </div>
  <div class='fragment'>
  Note that both of these pieces of code will NOT work without a <pre style=display:inline><code style=display:inline class='r'>geom()</code></pre>
  <br/>
  <br/>
  </div>
  <div class='fragment'>
  Also, all aesthetics here have been defined globally.
  <p>
    A full list of aesthetic specifications can be found <a href='http://docs.ggplot2.org/current/vignettes/ggplot2-specs.html'>here</a>
  </p>
  </div>
  <aside class='notes'>
  </aside>
</section>

<section>
  <h3>
    Using <pre style=text-transform:lowercase;display:inline><code class='r' style=text-transform:lowercase;display:inline>geom()</code></pre>
  </h3>
  This is where we define the type of graph that we want to produce.
  There are a large number of geoms to choose from.
  <div class='fragment'>
  <p>
    Here are a few:
  </p>
  <table class='stretch'>
    <thead><th>Function</th><th>Usage</th></thead>
    <tbody>
      <tr><td><pre><code class='r'>geom_bar()</code></pre></td><td>Used to produce bar plots</td></tr>
      <tr><td><pre><code class='r'>geom_boxplot()</code></pre></td><td>Used to produce boxplots</td></tr>
      <tr><td><pre><code class='r'>geom_point()</code></pre></td><td>Used to produce scatterplots</td></tr>
      <tr><td><pre><code class='r'>geom_dotplot()</code></pre></td><td>Used to produce dot plots</td></tr>
    </tbody>
  </table>
  </div>
</section>

<section>
  <h3>
    Joining things up
  </h3>
  <p>
    To create a ggplot, we combine the aes and geoms:
  </p>
  <pre><code class='r'>ggplot(data = mtcars, aes(x = mpg, y = hp, colour = as.factor(vs), shape = as.factor(gear))) +
  geom_point()</code></pre>
  <div align='center'>
    <img src='./resources/plot1-eg.svg' style='border:0' width='50%'/>
  </div>
</section>

<section>
  <h3>
    Joining things up
  </h3>
  <p style='font-size:80%'>
    The previous slide demonstrated a globally defined aesthetic, here a locally defined aesthetic is demonstrated:
  </p>
  <pre><code class='r'>ggplot(data = mtcars) +
  geom_point(aes(x = mpg, y = hp, colour = as.factor(vs), shape = as.factor(gear)))</code></pre>
  <div align='center'>
    <img src='./resources/plot1-eg.svg' style='border:0' width='50%'/>
  </div>
</section>

<section>
  <h3>
    Joining things up
  </h3>
  <div style='font-size:60%'>
    <p>
      In the above examples, both locally and globally defined aesthetics produce the same result.
    </p>
    <p>
      However, they can be used to overlay data.
    </p>
    <pre><code class='r'>ggplot(data = mtcars, aes(x = mpg, y = hp, colour = as.factor(vs), shape = as.factor(gear))) +
  geom_point()+
  geom_dotplot(aes(x=mpg,y=hp,fill=as.factor(vs)))
#`stat_bindot()` using `bins = 30`. Pick better value with `binwidth`.
</code></pre>
  </div>
  <div align='center'>
    <img src='./resources/plot2-eg.svg' style='border:0' width='50%'/>
  </div>
</section>

<section align='center'>
  <h2>
    Saving your graphs
  </h2>
</section>

<section>
  <h3>
    saving using ggplot2
  </h3>
  ggplot has a built in function to save plots, <pre style=display:inline><code style=display:inline class='r'>ggsave()</code></pre>
  <div class='fragment'>
  <p>
    It is pretty easy to use and allows you to save in a number of formats:
  </p>
  <pre><code class='r'>my_plot <- ggplot( mtcars, aes( mpg , hp) +
  geom_point()

ggsave( 'my-plot.pdf' , my_plot )
ggsave( 'my-plot.png' , my_plot )
ggsave( 'my-plot.jpeg' , my_plot )
ggsave( 'my-plot.svg' , my_plot ) # requires svglite package</code></pre>
</div>

    <div class='fragment'>
<pre style=display:inline><code style=display:inline class='r'>ggsave()</code></pre> is rather clever and infers the file format from the file extension.
    </div>
</section>

  <section>
    <h3>
      saving using R
    </h3>
    Naturally, R also has functions to save images to file. The two that I use the most are <pre style=display:inline><code style=display:inline class='r'>pdf()</code></pre> and <pre style=display:inline><code style=display:inline class='r'>svg()</code></pre>
    <div class='fragment'>
    <pre><code class='r'>my_plot <- ggplot( mtcars, aes( mpg , hp) +
  geom_point()

pdf('my-plot.pdf')
my_plot
dev.off()

svg('my-plot.svg')
my_plot
dev.off()
</code></pre>

Note that with these functions, you must close the graphics device after producing the image.
</div>
</section>

  </section>




  <!--    NEW TOP LEVEL SLIDE      -->
  <section align='left'>

    <section align='center'>
      <h2>
        Trend lines &amp; Error bars
      </h2>
    </section>

    <section>
      <h3>
        Trend Lines: <pre style='display:inline;text-transform:lowercase'><code style='display:inline;text-transform:lowercase' class='r'>geom_smooth()</code></pre>
      </h3>
      <div style='font-size:70%'>
        ggplot2 has a built in <pre  style='display:inline'><code style='display:inline' class='r'>geom()</code></pre> that deals with adding trend lines to plots.
        It is called <pre  style='display:inline' ><code  style='display:inline' class='r'>geom_smooth()</code></pre>
        <pre><code class='r'>ggplot( mtcars , aes( x = mpg , y = hp)) +
    geom_point() +
    geom_smooth()
#`geom_smooth()` using method = 'loess'
</code></pre>
      </div>
      <div align='center'>
        <img src='./resources/plot3-eg.svg'style='border:0' width=50%/>
      </div>
    </section>

    <section>
      <h3>
        Trend Lines: <pre style='display:inline;text-transform:lowercase'><code style='display:inline;text-transform:lowercase' class='r'>geom_smooth()</code></pre>
      </h3>
      <div style='font-size:70%'>
        As with all geoms, <pre style=display:inline><code style=display:inline class='r'>geom_smooth()</code></pre> is responsive to aesthetics.
        <pre><code class='r'>ggplot( mtcars , aes( x = mpg , y = hp)) +
    geom_point() +
    geom_smooth( aes( colour = as.factor(vs) ))
#`geom_smooth()` using method = 'loess'
</code></pre>
      </div>
      <div align='center'>
        <img src='./resources/plot4-eg.svg'style='border:0' width=50%/>
      </div>
    </section>

    <section>
      <h3>
        Trend Lines: <pre style='display:inline;text-transform:lowercase'><code style='display:inline;text-transform:lowercase' class='r'>geom_smooth()</code></pre>
      </h3>
      <div style='font-size:70%'>
        <pre style=display:inline><code style=display:inline class='r'>geom_smooth()</code></pre> aims to select the best smoothing method for your data but you can override this choice.
        <pre><code class='r'>ggplot( mtcars , aes( x = mpg , y = hp , colour = as.factor(vs))) +
    geom_point() +
    geom_smooth( aes( colour = as.factor(vs) ) , method='lm')
</code></pre>
      </div>
      <div align='center'>
        <img src='./resources/plot5-eg.svg'style='border:0' width=50%/>
      </div>
    </section>

    <section>
      <h3>
        Trend Lines: custom
      </h3>
      <div style='font-size:70%'>
        If you want to add a line from a custom analysis you can use <pre style=display:inline><code style=display:inline class='r'>geom_abline()</code></pre>, provided that you know the intercept and slope of the line.
        However, for most basic analyses, <pre style=display:inline><code style=display:inline class='r'>geom_smooth()</code></pre> is a better option.
        <pre><code class='r'>ggplot( mtcars , aes( x = mpg , y = hp)) +
    geom_point() +
    geom_abline(intercept = 250 , slope = -5)
</code></pre>
      </div>
      <div align='center'>
        <img src='./resources/abline-plot.svg'style='border:0' width=50%/>
      </div>
    </section>

    <section>
      <h3>
        Error bars
      </h3>
      <p>
        Adding error bars to a plot is just like adding another layer/geom, you just need to calculate the values.
      </p>
      <pre><code class='r'>library(psych) # Load in psych package for descriptive stats

# get means
mpg_gear_mean <- c( describe( mtcars$mpg[ mtcars$gear == 3 ] )$mean , describe( mtcars$mpg[ mtcars$gear == 4 ] )$mean , describe( mtcars$mpg[ mtcars$gear == 5 ] )$mean )

# produce gear index
gear <- c( 3 , 4 , 5 )

# combine into data frame
mpg_gear <- as.data.frame( cbind( mpg_gear_mean , gear ) )

# add standard error and standard deviation to data frame
mpg_gear$se <- c( describe( mtcars$mpg[ mtcars$gear == 3 ] )$se , describe( mtcars$mpg[ mtcars$gear == 4 ] )$se , describe( mtcars$mpg[ mtcars$gear == 5 ] )$se )
mpg_gear$sd <- c( sd( mtcars$mpg[ mtcars$gear == 3 ] ) , sd( mtcars$mpg[ mtcars$gear == 4 ] ) , sd( mtcars$mpg[ mtcars$gear == 5 ] ) )

# look at the data
mpg_gear

#  mpg_gear_mean gear        se       sd
#1      16.10667    3 0.8705481 3.371618
#2      24.53333    4 1.5232707 5.276764
#3      21.38000    5 2.9779859 6.658979

</code></pre>
  </section>

      <section>
        <h3>
          se bars: producing the plot
        </h3>
        <div style='font-size:80%'>
          We now use the subset of data we created in the last slide to produce our plot with standard error bars
          <pre><code class='r'>ggplot( mpg_gear , aes(gear , mpg_gear_mean , fill = as.factor(gear)))+
  geom_bar( stat = 'identity')+
  geom_errorbar( aes( ymax = mpg_gear_mean + se, ymin = mpg_gear_mean - se) , width = 0.25)</code></pre>
        </div>
        <div align='center'>
          <img src='./resources/plot6-eg.svg' width='50%' style='border:0'/>
        </div>
      </section>

      <section>
        <h3>
          sd bars: producing the plot
        </h3>
        <div style='font-size:80%'>
          Using the same subset of data we used to created the se bars, we can produce our plot with sd bars.
          <pre><code class='r'>ggplot( mpg_gear , aes(gear , mpg_gear_mean , fill = as.factor(gear)))+
  geom_bar( stat = 'identity')+
  geom_errorbar( aes( ymax = mpg_gear_mean + sd , ymin = mpg_gear_mean - sd) , width = 0.25)</code></pre>
        </div>
        <div align='center'>
          <img src='./resources/plot7-eg.svg' width='50%' style='border:0'/>
        </div>
      </section>

    </section>




    <!--    NEW TOP LEVEL SLIDE      -->
    <section align='left'>
      <section>
        <h2 align='center'>
          Labelling &amp; text
        </h2>
      </section>

      <section>
        <h3>
          Labelling
        </h3>
        <div style='font-size:70%'>
          <p>
            ggplot2 would be a pretty rubbish package if it didn't allow for custom labels.
          </p>
          <div class='fragment'>
          Changing labels in ggplot2 is pretty straightforward and is similar to adding a geom.
          To do this, we use the <pre style='display:inline'><code style='display:inline' class='r'>labs()</code></pre> ggplot funtion.
        </div>
        </div>
        <div class='fragment'>
        <table style='font-size:80%'>
          <thead><th>Code</th><th>Function</th></thead>
          <tbody>
            <tr><td><pre><code class='r'>labs(x = 'x label')</code></pre></td><td>Set the x axis label</td></tr>
            <tr><td><pre><code class='r'>labs(y = 'y label')</code></pre></td><td>Set the y axis label</td></tr>
            <tr><td><pre><code class='r'>labs(colour = 'gear')</code></pre></td><td>Set the legend title <small>(provided that you grouped by the colour aesthetic)</small></td></tr>
            <tr><td><pre><code class='r'>labs(title = 'Plot Title')</code></pre></td><td>Set the plot title</td></tr>
            <tr><td><pre><code class='r'>labs(subtitle = 'Plot Subtitle')</code></pre></td><td>Set the plot subtitle</td></tr>
            <tr><td><pre><code class='r'>labs(caption = 'Caption')</code></pre></td><td>Set the plot caption</td></tr>
          </tbody>
        </table>
        </div>
      </section>

      <section>
        <h3>
          Labelling in practice
        </h3>
        <div style='font-size:80%'>
          All of the labelling options can be compressed into one call to the <pre style='display:inline'><code style='display:inline' class='r'>labs()</code></pre> function, e.g.
          <pre><code class='r'>ggplot( mtcars , aes( x = mpg , y = hp , colour = as.factor( gear ))) +
  geom_point()+
  labs(x = 'Miles per Gallon' , y = 'Horse Power' , colour = 'Number of\ngears' , title = 'My first ggplot' , subtitle = 'Gee, I sure do love ggplot!', caption = 'Not too sure where all the cats are though')
</code></pre>
        </div>
        <div align='center'>
          <img src='./resources/label-plot.svg' style='border:0' width='50%'/>
        </div>
      </section>

      <section>
        <h3>
          Adding a text overlay
        </h3>
        <div style='font-size:70%'>
          Sometimes you might want to add a text overlay (eg. an r<sup>2</sup> value or a p value).
          We can do this using <pre style='display:inline'><code style='display:inline'class='r'>annotate()</code></pre>
          <pre><code class='r'>library(Hmisc) # load Hmisc package for the rcorr function. Warning, Hmisc may mask functions!
cor_vals <- rcorr( mtcars$mpg , mtcars$hp)
ggplot( mtcars , aes( x = mpg , y = hp)) +
  geom_point() +
  geom_smooth( method = 'lm' , se = FALSE ) +
  annotate('text' , x = 30 , y = 300 , label = paste('R^2 == ' , round(cor_vals$r[1,2],3) , sep=''), parse = T) +
  annotate('text' , x = 30 , y = 280 , label = paste('p ==', round(cor_vals$P[1,2],8) , sep=''), parse = T) +
  labs(x = 'Miles per Gallon' , y = 'Horse Power' , title = 'My first ggplot' , subtitle = 'Gee, I sure do love ggplot!', caption = 'Not too sure where all the cats are though') +
  theme_classic()</code></pre>
  </div>
          <div align='center'>
            <img src='./resources/cor-plot-annote.svg' style='border:0' width='40%'/>
          </div>
          </section>

      </section>





      <!--    NEW TOP LEVEL SLIDE      -->
      <section align='left'>
        <section>
          <h2 align='center'>
            interactive graphs
          </h2>
        </section>

        <section>
          <h3>
            Interactive Graphs
          </h3>
          <p>
            R has a lot of advanced functionality for producing interactive graphics.
            We can only offer a cursory glance into the full capabilities here.
          </p>
          <div class='fragment'>
          <table>
            <tr>
              <td>
                <p>
                  However, a good place to start is with the plotly package.
                </p>
              </td>
              <td style='vertical-align:top'>
                <img src='./resources/plotly.png' style='border:0;float:right'/>
              </td>
            </tr>
          </table>
          </div>
        </section>

        <section>
          <h3>
            Interactive Graphs
          </h3>

          plotly has the built-in function <pre style=display:inline><code style=display:inline class='r'>ggplotly()</code></pre> for conversion of ggplot objects to interactive html files.
          <div class='fragment'>
          <p>
            For instance, if we produce a simple ggplot object:
          </p>
          <pre><code class='r'>my_plot <- ggplot( mtcars , aes( mpg , hp , colour = as.factor(gear))) +
  geom_point() +
  theme_minimal()</code></pre>
  <p>
  It can be turned into an interactive plot by calling the following:
  </p>
  <pre><code class='r'>library(plotly)
  ggplotly(my_plot)</code></pre>
  </div>
  </section>

          <section>
            <h3>
              Interactive Graphs
            </h3>
            <p>
              The code on the previous slide produces the following graph
            </p>
            <iframe src='./resources/int_plot/int-plot.html' class='stretch'>
            </iframe>

          </section>

          <section>
            <h3>
              3D Graphs
            </h3>
            <p>
              plotly can also render 3D interactive graphics:
            </p>
            <iframe src='./resources/int_plot/volcano.html' class='stretch'>
            </iframe>
            <pre><code>add_surface(plot_ly(z = ~volcano))</code></pre>
          </section>

          <section>
            <p>
              Both R and plotly have a number of advanced functions for generating interactive graphs.
            </p>
            <p class='fragment'>
              What we have endeavoured to do here is to demonstrate how simple it can be (provided that your data are tidy!).
            </p>
          </section>

        </section>



        <!--    NEW TOP LEVEL SLIDE      -->
        <section align='left'>

          <section>
            <h2 align='center'>
              Report Generation
            </h2>
            <aside class='notes'>

            </aside>
          </section>
          <section>
            <h3>
              Report Generation
            </h3>
            <p>
              R makes it easy to quickly produce a report of your data analysis.
            </p>
            <p class='fragment'>
              This could be for something such as a supervisor meeting, progress review or draft conference submission.
            </p>
            <div class='fragment'>
            <table>
              <tr>
                <td>
                  <p>
                    To do this, we use the knitr package.
                  </p>
                </td>
                <td style='vertical-align:top'>
                  <img src='./resources/knit-logo.png' style='border:0'/>
                </td>
              </tr>
            </table>
            </div>
          </section>

          <section>
            <h3>
              Knitr
            </h3>
            <p>
              Knitr can output reports in a variety of formats (including .tex for LaTeX users) but two of the most useful formats are likely to be .pdf and .html
            </p>
            <div class='fragment'>
            <p>
              Knitr, like ggplot and plotly, has a lot of advanced functionality but here we will focus on just two functions:
            </p>
            <pre><code class='r'># 1
stitch()

# 2
stitch_rhtml()</code></pre>
            </div>
          </section>

          <section>
            <h3>
              Knitr
            </h3>
            <p>
              To use these report generation functions, you must have a script.
            </p>
            <p>
              For demonstration purposes, we will use the following script
            </p>
            <pre><code class='r'>##title: Check out my fancy report
##author: Vijay

# Here is some text
library(ggplot2)
ggplot(mtcars,aes(mpg,hp,colour=as.factor(gear)))+
  geom_point()
# Here is more text</code></pre>
          </section>

          <section>
            <h3>
              <pre style=text-transform:lowercase;display:inline><code style=text-transform:lowercase;display:inline class='r'>stitch()</code></pre>
            </h3>
            Using the <pre style=display:inline><code style=display:inline class='r'>stitch()</code></pre> function is straightforward if you have written a script.
            <div class='fragment'>
            <p>
              The code to produce a pdf is simply:
            </p>
            <pre><code class='r'>stitch('my_script.r')</code></pre>
            <p>
              If your script is not in the working directory, you must specify the location of the file
            </p>
            </div>
            <div class='fragment'>
            <p>
              *note*: pdflatex is required to produce pdf files, see <a href='https://www.latex-project.org'>https://www.latex-project.org</a> for details.
            </p>
            </div>
          </section>

<section>
            <object data='./resources/my_script.pdf' class='stretch'>
            </object>

          </section>

          <section>
            <h3>
              <pre style=text-transform:lowercase;display:inline><code style=text-transform:lowercase;display:inline class='r'>stitch_rhtml()</code></pre>
            </h3>
            Using the <pre style=display:inline><code style=display:inline class='r'>stitch_rhtml()</code></pre> function is straightforward if you have written a script.
            <div class='fragment'>
            <p>
              The code to produce a html file is simply:
            </p>
            <pre><code class='r'>stitch_rhtml('my_script.r')</code></pre>
            <p>
              If your script is not in the working directory, you must specify the location of the file
            </p>
            </div>
          </section>

          <section>
            <iframe src='./resources/my_script.html' class='stretch'>
            </iframe>
          </section>

          <section>
            <h3>
              Knitr
            </h3>
            <p>
            Knitr is a powerful report generation tool and the features demonstrated here are really only scratching the surface.
            </p>
            <p class='fragment'>
              It is possible to write entire research papers and websites using packages such as knitr, please do investigate it further.
            </p>
          </section>


        </section>

        <section align='left'>
          <section align='center'>
          <h2>
            Working through an analysis script
            </h2>
            </section>

          <section>
          <h3>
            Research Question
          </h3>
          <p>
            Like any analysis, you have to start with a question.
          </p>
          <p>
            For this analysis, we will be using the 'USPersonalExpenditure' dataset that is included with R.
            To see this dataset, run the following code:
          </p>
          <pre><code class='r'>View(USPersonalExpenditure)</code></pre>
            <div class='fragment'>
            <p>
              Our research question is simple:
            </p>
            <p>
              RQ: Did personal expenditure on Private Education in the US increase between 1940 and 1960?
            </p>
            </div>
        </section>

          <section>
            <div style='font-size:70%'>
            <pre><code class='r'>##title: My short analysis
##author: Vijay

# First we load the packages
library(tidyr)
library(ggplot2)
library(Hmisc)
library(psych)

pers_exp <- USPersonalExpenditure

# Let's look at the data
pers_exp	#it looks like the row names are not actually in the matrix
		#let's fix that

expenditure_type <- rownames(pers_exp)
expenditure_type <- gsub( ' ' , '_' , expenditure_type) # Replace spaces with underscores
rownames(pers_exp) <- NULL
pers_exp <- as.data.frame(pers_exp)
pers_exp <- cbind(expenditure_type,pers_exp)

# Let's look at the data now
pers_exp	#better, but it doesn't look tidy to me
		#let's fix that


pers_exp <- gather( pers_exp , `1940` , `1945` , `1950` , `1955` , `1960` ,
	key = year, value =  expenditure)
pers_exp <- spread( pers_exp , key = expenditure_type , value = expenditure)

# Let's look at the data now
pers_exp	#better

# We should now look at some descriptive stats
# Let's use the describe function from the psych package
psych::describe(pers_exp)

# Okay, that's nice but we really just want the Private Education info

psych::describe(pers_exp$Private_Education)

# This shows a difference between the minumum and maximum values
# with both the mean and median roughly in between.
# This would suggest a general change, but we cannot be sure of the direction.
# A plot might help with this

# Plot private education over time
ggplot( pers_exp , aes( year , Private_Education))+
	geom_bar(stat='identity')+
	labs( x = 'Year' , y = 'Expenditure on private education\nin billions of $') +
	theme_classic()
# This plot shows that expenditure on Private Education has
# increased between 1940 and 1960.

# Let's now see if the correlation between these values is significant

# First calculate correlation and p-value
cor_vals <- rcorr( pers_exp$year , pers_exp$Private_Education )

# Straight up scatter plot
ggplot( pers_exp , aes( x = as.numeric(year) , y = Private_Education)) +
  geom_point() +
  geom_smooth(method='lm') +
  annotate('text' , x = 1945 , y = 3.2 ,
    label = paste('R^2 == ' , round(cor_vals$r[1,2],3) , sep=''), parse = T) +
  annotate('text' , x = 1945 , y = 3 ,
    label = paste('p ==', round(cor_vals$P[1,2],5) , sep=''), parse = T) +
  labs(x = 'Year' , y = 'Expenditure on private education\nin billions of $') +
  theme_classic()

# Bar plot with scatter plot overlay
ggplot( pers_exp , aes( x = as.numeric(year) , y = Private_Education)) +
  geom_bar(stat='identity')+
  geom_point() +
  geom_smooth(method='lm') +
  annotate('text' , x = 1945 , y = 3.2 ,
    label = paste('R^2 == ' , round(cor_vals$r[1,2],3) , sep=''), parse = T) +
  annotate('text' , x = 1945 , y = 3 ,
    label = paste('p ==', round(cor_vals$P[1,2],5) , sep=''), parse = T) +
  labs(x = 'Year' , y = 'Expenditure on private education\nin billions of $') +
  theme_classic()
  </code></pre>
              <pre><code class='r'>library(knitr)
stitch('my-simple-report.r')</code></pre>
            </div>
          </section>

          <section>
            <object data='./resources/my-simple-report.pdf' class='stretch'>
            </object>
          </section>
        </section>

          <section align='left'>

            <section align='center'>
              <h2>
                Projects
              </h2>
            </section>

            <section>
              <p>
                Ulitimately you will have to perform an analysis in R by yourself.
              </p>
              <p>
                So, we wanted to take the time today to allow you to work through a full analysis with our support.
              </p>
              <p>
                Please feel free to either work in a group or on your own.
              </p>
              <p>
                See next slide for more info...
              </p>
            </section>

            <section>
              <p>
                You have two choices:
              </p>
              <ol>
                <li type='A'>Work with one of R's built in datasets <pre style=display:inline><code style=display:inline class='r'>data()</code></pre>(easier)</li>
                <li type='A'>Download a dataset from the <a href='https://data.gov.uk'>UK government database</a> (harder)</li>
              </ol>
              <p>
                Once you have selected a dataset that appeals to you your task is to do the following:
              </p>
              <ol>
                <li>Design a research question about your data</li>
                <li>Import your data, tidy it and produce relevant descriptive stats</li>
                <li>Generate plots that help to answer your research question</li>
                <li>Use your script to produce a report using knitr</li>
              </ol>
            </section>

          </section>

        </div>
      </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>
      // More info https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        height:800,
        width:960,
        margin: 0.1,
        minScale: 0.2,
        maxScale:1.5,
        // Display controls in the bottom right corner
        controls: true,

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Vertical centering of slides
        center: true,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: Reveal.navigateNext,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // Hides the address bar on mobile devices
        hideAddressBar: true,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style
        transition: 'concave', // none/fade/slide/convex/concave/zoom

        // Transition speed
        transitionSpeed: 'default', // default/fast/slow

        // Transition style for full page slide backgrounds
        backgroundTransition: 'concave', // none/fade/slide/convex/concave/zoom

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Parallax background image
        parallaxBackgroundImage: '', // e.g. "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'"

        // Parallax background size
        parallaxBackgroundSize: '', // CSS syntax, e.g. "2100px 900px"

        // Number of pixels to move the parallax background per slide
        // - Calculated automatically unless specified
        // - Set to 0 to disable movement along an axis
        parallaxBackgroundHorizontal: null,
        parallaxBackgroundVertical: null,

        // More info https://github.com/hakimel/reveal.js#dependencies
        dependencies: [
          { src: 'lib/js/classList.js', condition: function ()
           { return !document.body.classList;}},
          { src: 'plugin/markdown/marked.js' },
          { src: 'plugin/markdown/markdown.js' },
          { src: 'plugin/notes/notes.js', async: true },
          { src: 'plugin/zoom-js/zoom.js', async: true, condition: function () { return !!document.body.classList; } },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
        ]
      });
      Reveal.configure({ pdfMaxPagesPerSlide: 1 });
    </script>
    </body>
  </html>
